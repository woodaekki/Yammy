import { useState } from 'react';
import './SNSPage.css';

const ImageCarousel = ({ images, postId }) => {
    const [currentIndex, setCurrentIndex] = useState(0);
    const [touchStart, setTouchStart] = useState(0);
    const [touchEnd, setTouchEnd] = useState(0);

    const goToNext = () => {
        setCurrentIndex((prev) => (prev + 1) % images.length);
    };

    const goToPrev = () => {
        setCurrentIndex((prev) => (prev - 1 + images.length) % images.length);
    };

    // ÌÑ∞Ïπò/ÎßàÏö∞Ïä§ Ïä§ÏôÄÏù¥ÌîÑ Í∞êÏßÄ
    const handleTouchStart = (e) => {
        setTouchStart(e.type === 'touchstart' ? e.touches[0].clientX : e.clientX);
    };

    const handleTouchMove = (e) => {
        setTouchEnd(e.type === 'touchmove' ? e.touches[0].clientX : e.clientX);
    };

    const handleTouchEnd = () => {
        if (!touchStart || !touchEnd) return;

        const distance = touchStart - touchEnd;
        const isLeftSwipe = distance > 50;
        const isRightSwipe = distance < -50;

        if (isLeftSwipe && currentIndex < images.length - 1) {
            goToNext();
        }
        if (isRightSwipe && currentIndex > 0) {
            goToPrev();
        }

        setTouchStart(0);
        setTouchEnd(0);
    };

    return (
        <div className="image-carousel">
            <div
                className="carousel-slider"
                onTouchStart={handleTouchStart}
                onTouchMove={handleTouchMove}
                onTouchEnd={handleTouchEnd}
                onMouseDown={handleTouchStart}
                onMouseMove={handleTouchMove}
                onMouseUp={handleTouchEnd}
                onMouseLeave={handleTouchEnd}
            >
                <div
                    className="carousel-track"
                    style={{ transform: `translateX(-${currentIndex * 100}%)` }}
                >
                    {images.map((image, index) => (
                        <div key={index} className="carousel-slide">
                            <img
                                src={image}
                                alt={`post ${postId} image ${index + 1}`}
                                draggable="false"
                            />
                        </div>
                    ))}
                </div>
            </div>

            {images.length > 1 && (
                <div className="carousel-dots">
                    {images.map((_, index) => (
                        <span
                            key={index}
                            className={`dot ${index === currentIndex ? 'active' : ''}`}
                        />
                    ))}
                </div>
            )}
        </div>
    );
};

const SNSPage = () => {
    const [posts, setPosts] = useState([
        {
            id: 1,
            author: 'ÍπÄÏ≤†Ïàò',
            avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg',
            time: '2ÏãúÍ∞Ñ Ï†Ñ',
            content: 'Ïò§Îäò Í≤ΩÍ∏∞ Ï†ïÎßê ÏßúÎ¶øÌñàÎã§! ÎßàÏßÄÎßâ Í≥® Ïû•Î©¥ÏùÄ ÏßÑÏßú ÏÜåÎ¶Ñ ÎèãÏïòÏñ¥ ‚öΩÔ∏èüî•',
            images: [
                'https://storage.googleapis.com/uxpilot-auth.appspot.com/dce6e55300-6e1d23662ab252d21081.png',
                'https://storage.googleapis.com/uxpilot-auth.appspot.com/c9fb85da1e-45116d9a79a3ab78a16e.png',
                'https://storage.googleapis.com/uxpilot-auth.appspot.com/9a28a09c34-1b9e46f46d9df7dbde90.png'
            ],
            likes: 127,
            comments: 23,
            isLiked: false,
            isFollowing: false
        },
        {
            id: 2,
            author: 'Î∞ïÏòÅÌù¨',
            avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-5.jpg',
            time: '4ÏãúÍ∞Ñ Ï†Ñ',
            content: 'ÏÉàÎ°úÏö¥ ÎÜçÍµ¨Ìôî Í≤ü! Ïù¥Ï†ú Îçî Î©ãÏßÑ ÏäõÏùÑ ÎÇ†Î¶¥ Ïàò ÏûàÏùÑ Í≤É Í∞ôÏïÑ üèÄ‚ú®',
            images: [
                'https://storage.googleapis.com/uxpilot-auth.appspot.com/98cb1f43e3-528b8a3b540bea1f4652.png'
            ],
            likes: 89,
            comments: 15,
            isLiked: true,
            isFollowing: true
        },
        {
            id: 3,
            author: 'Ïù¥ÎØºÏàò',
            avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-3.jpg',
            time: '6ÏãúÍ∞Ñ Ï†Ñ',
            content: 'Ïò§Îäò ÎßàÎùºÌÜ§ ÏôÑÏ£º! Í∞úÏù∏ ÏµúÍ≥† Í∏∞Î°ù Í∞±Ïã†ÌñàÎã§ üí™ Îã§ÏùåÏóî Îçî Îπ†Î•¥Í≤å!',
            images: [
                'https://storage.googleapis.com/uxpilot-auth.appspot.com/60a72d35f1-09cace140106185bf5cc.png',
                'https://storage.googleapis.com/uxpilot-auth.appspot.com/e769c887d5-dd8311b543509738c710.png'
            ],
            likes: 156,
            comments: 34,
            isLiked: false,
            isFollowing: false
        }
    ]);

    const toggleLike = (postId) => {
        setPosts(posts.map(post =>
            post.id === postId
                ? { ...post, isLiked: !post.isLiked, likes: post.isLiked ? post.likes - 1 : post.likes + 1 }
                : post
        ));
    };

    const toggleFollow = (postId) => {
        setPosts(posts.map(post =>
            post.id === postId
                ? { ...post, isFollowing: !post.isFollowing }
                : post
        ));
    };

    return (
        <div className="sns-page">
            {/* ÌîºÎìú ÏÑπÏÖò */}
            <div className="feed-container">
                {posts.map(post => (
                    <div key={post.id} className="post-card">
                        {/* Í≤åÏãúÎ¨º Ìó§Îçî */}
                        <div className="post-header">
                            <div className="post-author">
                                <img src={post.avatar} alt={post.author} className="author-avatar" />
                                <div className="author-info">
                                    <h3 className="author-name">{post.author}</h3>
                                    <p className="post-time">{post.time}</p>
                                </div>
                            </div>
                            <button className="post-menu-btn">‚ãØ</button>
                        </div>

                        {/* Í≤åÏãúÎ¨º ÎÇ¥Ïö© */}
                        <div className="post-content">
                            <p>{post.content}</p>
                        </div>

                        {/* Í≤åÏãúÎ¨º Ïù¥ÎØ∏ÏßÄ */}
                        <ImageCarousel images={post.images} postId={post.id} />

                        {/* Í≤åÏãúÎ¨º Ïï°ÏÖò */}
                        <div className="post-actions">
                            <div className="action-buttons">
                                <button
                                    className={`action-btn ${post.isLiked ? 'liked' : ''}`}
                                    onClick={() => toggleLike(post.id)}
                                >
                                    <span className="action-icon">{post.isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                                    <span className="action-count">{post.likes}</span>
                                </button>
                                <button className="action-btn">
                                    <span className="action-icon">üí¨</span>
                                    <span className="action-count">{post.comments}</span>
                                </button>
                                <button className="action-btn">
                                    <span className="action-icon">üì§</span>
                                </button>
                            </div>
                            <button
                                className={`follow-btn ${post.isFollowing ? 'following' : ''}`}
                                onClick={() => toggleFollow(post.id)}
                            >
                                {post.isFollowing ? 'ÌåîÎ°úÏûâ' : 'ÌåîÎ°úÏö∞'}
                            </button>
                        </div>

                        {/* Ï¢ãÏïÑÏöî Ïàò */}
                        <div className="post-likes">
                            <span>Ï¢ãÏïÑÏöî {post.likes}Í∞ú</span>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};

export default SNSPage;
